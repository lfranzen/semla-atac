<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.649">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Images and spot coordinates</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="images_and_coordinates_files/libs/clipboard/clipboard.min.js"></script>
<script src="images_and_coordinates_files/libs/quarto-html/quarto.js"></script>
<script src="images_and_coordinates_files/libs/quarto-html/popper.min.js"></script>
<script src="images_and_coordinates_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="images_and_coordinates_files/libs/quarto-html/anchor.min.js"></script>
<link href="images_and_coordinates_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="images_and_coordinates_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="images_and_coordinates_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="images_and_coordinates_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="images_and_coordinates_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Images and spot coordinates</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>Load required libraries:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(STUtility2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magick)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="image-transformation" class="level2">
<h2 class="anchored" data-anchor-id="image-transformation">Image transformation</h2>
<hr>
<p><code>STUtility2</code> uses the <code>magick</code> R package to read and process images. Please have a look at <a href="https://cran.r-project.org/web/packages/magick/vignettes/intro.html">this</a> vignette if you want to know more about <code>magick</code>.</p>
<p>Let’s load an H&amp;E image and visualize it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>he <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"extdata/mousebrain/spatial"</span>, <span class="st">"tissue_hires_image.png"</span>, <span class="at">package =</span> <span class="st">"STUtility2"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>im <span class="ot">&lt;-</span> <span class="fu">image_read</span>(he)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># get information about image</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>info <span class="ot">&lt;-</span> <span class="fu">image_info</span>(im)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>info</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  format width height colorspace matte filesize density
  &lt;chr&gt;  &lt;int&gt;  &lt;int&gt; &lt;chr&gt;      &lt;lgl&gt;    &lt;int&gt; &lt;chr&gt;  
1 PNG     1882   2000 sRGB       FALSE  5031054 72x72  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot HE image</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>im <span class="sc">|&gt;</span> <span class="fu">as.raster</span>() <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="fu">paste0</span>(info<span class="sc">$</span>width, <span class="st">"x"</span>, info<span class="sc">$</span>height))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="images_and_coordinates_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>The H&amp;E image is 2000 pixels high and 1882 pixels wide. If we want to scale this image, we can use <code>image_scale()</code> from <code>magick</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale down and plot HE image</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>im_small <span class="ot">&lt;-</span> im <span class="sc">|&gt;</span> <span class="fu">image_scale</span>(<span class="st">"400"</span>) </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>info_small <span class="ot">&lt;-</span> <span class="fu">image_info</span>(im_small)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>info_small</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  format width height colorspace matte filesize density
  &lt;chr&gt;  &lt;int&gt;  &lt;int&gt; &lt;chr&gt;      &lt;lgl&gt;    &lt;int&gt; &lt;chr&gt;  
1 PNG      400    425 sRGB       FALSE        0 72x72  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>im_small <span class="sc">|&gt;</span> <span class="fu">as.raster</span>() <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="fu">paste0</span>(info_small<span class="sc">$</span>width, <span class="st">"x"</span>, info_small<span class="sc">$</span>height))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="images_and_coordinates_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>We can also apply various types of transformations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotate image</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>im_rot <span class="ot">&lt;-</span> im_small <span class="sc">|&gt;</span> <span class="fu">image_rotate</span>(<span class="at">degrees =</span> <span class="dv">45</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Mirror image along x axis</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>im_xrefl <span class="ot">&lt;-</span> im_small <span class="sc">|&gt;</span> <span class="fu">image_flop</span>()</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Mirror image along y axis</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>im_yrefl <span class="ot">&lt;-</span> im_small <span class="sc">|&gt;</span> <span class="fu">image_flip</span>()</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">0</span>))</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>im_small <span class="sc">|&gt;</span> <span class="fu">as.raster</span>() <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="fu">paste0</span>(<span class="st">"original "</span>, info_small<span class="sc">$</span>width, <span class="st">"x"</span>, info_small<span class="sc">$</span>height))</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>im_rot <span class="sc">|&gt;</span> <span class="fu">as.raster</span>() <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="fu">paste0</span>(<span class="st">"rotated 45 degrees ("</span>, </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>             <span class="fu">image_info</span>(im_rot)<span class="sc">$</span>width, <span class="st">"x"</span>, <span class="fu">image_info</span>(im_rot)<span class="sc">$</span>height, <span class="st">")"</span>))</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>im_xrefl <span class="sc">|&gt;</span> <span class="fu">as.raster</span>() <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="fu">paste0</span>(<span class="st">"reflected along x axis ("</span>, </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>             <span class="fu">image_info</span>(im_xrefl)<span class="sc">$</span>width, <span class="st">"x"</span>, <span class="fu">image_info</span>(im_xrefl)<span class="sc">$</span>height, <span class="st">")"</span>))</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>im_yrefl <span class="sc">|&gt;</span> <span class="fu">as.raster</span>() <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="fu">paste0</span>(<span class="st">"reflected along y axis ("</span>, </span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>             <span class="fu">image_info</span>(im_yrefl)<span class="sc">$</span>width, <span class="st">"x"</span>, <span class="fu">image_info</span>(im_yrefl)<span class="sc">$</span>height, <span class="st">")"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="images_and_coordinates_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>When working with mutiple SRT datasets, it could be useful to align the tissue sections to have roughly the same orientation and size. In other words, we might want to register our H&amp;E images to a reference image. When doing so, we want to apply rotations, reflections and translations. The issue with the default <code>magick</code> rotation function is that it creates a bounding box to hold the entire image, which makes the image bigger. In the plots above you cans see that the rotated image is 586x586 pixels in size compared to the 400x425 of the other images.</p>
<p>The main issue is that if we want to map spots to our H&amp;E images after rotation, the scale has now changed and the spots will appear smaller. Instead, it is more convenient to keep the same input dimensions.</p>
<p><code>STUtility2</code> provide two functions to complement the transformation functions available in the <code>magick</code> R package: <code>ImageTranslate</code> and <code>ImageTransform</code>.</p>
<p><code>ImageTranslate</code> can be used to move H&amp;E image. If you imagine that you have an art board with the same dimensions as your image, this function can be used to move the H&amp;E image on the art board. However, only the part of the image that is inside the art board will be kept.</p>
<p><code>ImageTransform</code> can be used to rotate and translate H&amp;E images. Again, the transformations occur inside the art board and only the part of the image still inside the art board will be returned.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Move image 100 pixels to the right and 100 pixels down</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>im_rot <span class="ot">&lt;-</span> im_small <span class="sc">|&gt;</span> <span class="fu">ImageTranslate</span>(<span class="at">xy_offset =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">100</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotate image 45 degrees</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>im_transf <span class="ot">&lt;-</span> im_small <span class="sc">|&gt;</span> <span class="fu">ImageTransform</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">xy_offset =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotate image 45 degrees and move image 100 pixels to the left and 100 pixels up</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>im_transf2 <span class="ot">&lt;-</span> im_small <span class="sc">|&gt;</span> <span class="fu">ImageTransform</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">xy_offset =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="sc">-</span><span class="dv">100</span>))</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">0</span>))</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>im_small <span class="sc">|&gt;</span> <span class="fu">as.raster</span>() <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="fu">paste0</span>(<span class="st">"original ("</span>, info_small<span class="sc">$</span>width, <span class="st">"x"</span>, info_small<span class="sc">$</span>height, <span class="st">")"</span>))</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>im_rot <span class="sc">|&gt;</span> <span class="fu">as.raster</span>() <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="fu">paste0</span>(<span class="st">"moved towards bottom right corner ("</span>, </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>             <span class="fu">image_info</span>(im_rot)<span class="sc">$</span>width, <span class="st">"x"</span>, <span class="fu">image_info</span>(im_rot)<span class="sc">$</span>height, <span class="st">")"</span>))</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>im_transf <span class="sc">|&gt;</span> <span class="fu">as.raster</span>() <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="fu">paste0</span>(<span class="st">"rotated 45 degrees clockwise ("</span>, </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>             <span class="fu">image_info</span>(im_transf)<span class="sc">$</span>width, <span class="st">"x"</span>, <span class="fu">image_info</span>(im_transf)<span class="sc">$</span>height, <span class="st">")"</span>))</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>im_transf2 <span class="sc">|&gt;</span> <span class="fu">as.raster</span>() <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="fu">paste0</span>(<span class="st">"rotated 45 degrees clockwise and moved ("</span>, </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>             <span class="fu">image_info</span>(im_transf2)<span class="sc">$</span>width, <span class="st">"x"</span>, <span class="fu">image_info</span>(im_transf2)<span class="sc">$</span>height, <span class="st">")"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="images_and_coordinates_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>As you cans see, regardless of what transformation we apply, the image dimensions remain the same.</p>
</section>
<section id="spot-transformation" class="level2">
<h2 class="anchored" data-anchor-id="spot-transformation">Spot transformation</h2>
<hr>
<p>Let’s load some spot coordinates for the H&amp;E image that we have.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get example coordinate file</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>cordinatefile <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"extdata/mousebrain/spatial"</span>, </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"tissue_positions_list.csv"</span>, </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">package =</span> <span class="st">"STUtility2"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load coordinates</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>xy <span class="ot">&lt;-</span> <span class="fu">LoadSpatialCoordinates</span>(<span class="at">coordinatefiles =</span> cordinatefile, <span class="at">verbose =</span> T)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>xy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,992 × 7
   barcode            selected     y     x pxl_col_in_fullres pxl_row_…¹ sampl…²
   &lt;chr&gt;                 &lt;int&gt; &lt;int&gt; &lt;int&gt;              &lt;int&gt;      &lt;int&gt;   &lt;int&gt;
 1 ACGCCTGACACGCGCT-1        0     0     0               1796       2507       1
 2 TACCGATCCAACACTT-1        0     1     1               1974       2609       1
 3 ATTAAAGCGGACGAGC-1        0     0     2               1796       2711       1
 4 GATAAGGGACGATTAG-1        0     1     3               1975       2813       1
 5 GTGCAAATCACCAATA-1        0     0     4               1797       2916       1
 6 TGTTGGCTGGCGGAAG-1        0     1     5               1975       3018       1
 7 GCATCCTCTCCTATTA-1        0     0     6               1797       3121       1
 8 GCGAGGGACTGCTAGA-1        0     1     7               1975       3223       1
 9 TGGTACCGGCACAGCC-1        0     0     8               1797       3325       1
10 GCGCGTTTAAATCGTA-1        0     1     9               1976       3428       1
# … with 4,982 more rows, and abbreviated variable names ¹​pxl_row_in_fullres,
#   ²​sampleID</code></pre>
</div>
</div>
<p>Here we have access to the Visium grid coordinates and the H&amp;E image coordinates (for the full resolution image used for <code>spaceranger count</code>). We also have a column with spot barcodes and a column called <code>selected</code> which holds information about what sots are located under the tissue.</p>
<p>We can illustrate what this means with a plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(xy, <span class="fu">aes</span>(pxl_row_in_fullres, pxl_col_in_fullres, <span class="at">color =</span> <span class="fu">factor</span>(selected))) <span class="sc">+</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="images_and_coordinates_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As you can see, the spots with a value of 1 correspond to spots under the tissue. But right now, the tissue is upside down in the plot relative to our H&amp;E image. This is because the origin (0, 0) of the plot is located in the bottom left corner, but for images its in the upper right corner.</p>
<p>We can fix this easily by inverting the y axis. However, to do this properly, we need the dimensions of the H&amp;E image…</p>
<p>Unfortunately, we don’t have access to this information right now so we need to load the scalefactors and an H&amp;E image provided in the spaceranger output folder.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>scalefactorfile <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"extdata/mousebrain/spatial"</span>, </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"scalefactors_json.json"</span>, </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">package =</span> <span class="st">"STUtility2"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># read scalefactors</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>scalefactors <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">read_json</span>(scalefactorfile)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>scalefactors</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$spot_diameter_fullres
[1] 143.3171

$tissue_hires_scalef
[1] 0.1039393

$fiducial_diameter_fullres
[1] 214.9757

$tissue_lowres_scalef
[1] 0.03118179</code></pre>
</div>
</div>
<p>Now we can see that the scaling factor between the original H&amp;E image and the tissue_lowres image is ~0.03. Let’s load the tissue_lowres and convert our coordinates to fit the image:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>lowresimagefile <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"extdata/mousebrain/spatial"</span>, </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"tissue_lowres_image.png"</span>, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">package =</span> <span class="st">"STUtility2"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load image</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>im <span class="ot">&lt;-</span> <span class="fu">image_read</span>(lowresimagefile)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">image_info</span>(im)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  format width height colorspace matte filesize density
  &lt;chr&gt;  &lt;int&gt;  &lt;int&gt; &lt;chr&gt;      &lt;lgl&gt;    &lt;int&gt; &lt;chr&gt;  
1 PNG      565    600 sRGB       FALSE   467277 72x72  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert coordinates</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>xy <span class="ot">&lt;-</span> xy <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(pxl_col_in_fullres<span class="sc">:</span>pxl_row_in_fullres, </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span> .x<span class="sc">*</span>scalefactors<span class="sc">$</span>tissue_lowres_scalef))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are a couple of important things to pay attention to here. The x, y coordinates are now transformed to fit our H&amp;E image and therefore we can set the limits of the plot to be the same as the H&amp;E image dimensions (see <code>limits</code> in <code>scale_*_continuous()</code>). We also need to set <code>expand = c(0, 0)</code> to make sure that the margins are removed from the plot area. We also need to invert the y axis which we can do now that we have the H&amp;E image height (<code>image_info(im)$height</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> im <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rasterGrob</span>(<span class="at">width =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"npc"</span>), <span class="at">height =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"npc"</span>), <span class="at">interpolate =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(xy, <span class="fu">aes</span>(pxl_row_in_fullres, </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>               <span class="fu">image_info</span>(im)<span class="sc">$</span>height <span class="sc">-</span> pxl_col_in_fullres, </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="fu">factor</span>(selected))) <span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(g, <span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span>) <span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">image_info</span>(im)<span class="sc">$</span>width), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">image_info</span>(im)<span class="sc">$</span>height), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="images_and_coordinates_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<p>There are also functions available to apply transformations to spots: <code>CoordTransform</code> and <code>CoordMirror</code>.</p>
<p><code>CoordTransform</code> is equivalent to <code>ImageTransform</code> but for spot coordinates, meaning that you can apply rotations and translations. The main difference is that <code>CoordTransform</code> rotates around a predefined center. If you want apply the same rotation to an H&amp;E image and its corresponding spot coordinates, you want to set the <code>center</code> argument to be the center of the H&amp;E image.</p>
<p>Let’s demonstrate this with our spot coordinates:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only x, y coordinates</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>xy_coords <span class="ot">&lt;-</span> xy <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">1500</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(pxl_col_in_fullres, pxl_row_in_fullres)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Midpoint</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>c_xy <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(xy_coords)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply transformation to apot coordinates</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>xy_transformed <span class="ot">&lt;-</span> <span class="fu">CoordTransform</span>(xy_coords, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">xy_offset =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot spot coordinates</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">cbind</span>(xy_coords <span class="sc">|&gt;</span> <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)), <span class="at">type =</span> <span class="st">"original"</span>), </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">cbind</span>(xy_transformed <span class="sc">|&gt;</span> <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)), <span class="at">type =</span> <span class="st">"transformed"</span>))</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gg, <span class="fu">aes</span>(x, <span class="fu">image_info</span>(im)<span class="sc">$</span>height <span class="sc">-</span> y, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>type) <span class="sc">+</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">image_info</span>(im)<span class="sc">$</span>width), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">image_info</span>(im)<span class="sc">$</span>height), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> c_xy[<span class="dv">1</span>], <span class="at">y =</span> c_xy[<span class="dv">2</span>], </span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 155 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="images_and_coordinates_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<p>As you can see, the spots are rotated around the center of our spots (red dot). Instead, we want to define a center to rotate the spots around, which will the the center of our H&amp;E image.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only x, y coordinates</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>xy_coords <span class="ot">&lt;-</span> xy <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">1500</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(pxl_col_in_fullres, pxl_row_in_fullres)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply transformation to apot coordinates</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>xy_transformed <span class="ot">&lt;-</span> <span class="fu">CoordTransform</span>(xy_coords, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">xy_offset =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">center =</span> <span class="fu">c</span>(<span class="fu">image_info</span>(im)<span class="sc">$</span>width<span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">image_info</span>(im)<span class="sc">$</span>height <span class="sc">-</span> <span class="fu">image_info</span>(im)<span class="sc">$</span>height<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot spot coordinates</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">cbind</span>(xy_coords <span class="sc">|&gt;</span> <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)), <span class="at">type =</span> <span class="st">"original"</span>), </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">cbind</span>(xy_transformed <span class="sc">|&gt;</span> <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)), <span class="at">type =</span> <span class="st">"transformed"</span>))</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gg, <span class="fu">aes</span>(x, <span class="fu">image_info</span>(im)<span class="sc">$</span>height <span class="sc">-</span> y, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>type) <span class="sc">+</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">image_info</span>(im)<span class="sc">$</span>width), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">image_info</span>(im)<span class="sc">$</span>height), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="fu">image_info</span>(im)<span class="sc">$</span>width<span class="sc">/</span><span class="dv">2</span>, <span class="at">y =</span> <span class="fu">image_info</span>(im)<span class="sc">$</span>height<span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 15 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="images_and_coordinates_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<p>Now let’s have a look at how we can transform coordinates and images at the same time.</p>
</section>
<section id="transform-images-and-spots" class="level2">
<h2 class="anchored" data-anchor-id="transform-images-and-spots">Transform images and spots</h2>
<section id="rotation" class="level3">
<h3 class="anchored" data-anchor-id="rotation">Rotation</h3>
<p>The <code>CoordAndImageTransform</code> makes the transformation process a bit simpler. You can provide the H&amp;E image and its corresponding spot coordinates and apply transformations to both objects simultaneously. note that the spot coordinates are still defined the same way as before, i.e.&nbsp;the origin is in the top left corner. This means that we still need to invert the y axis.</p>
<p>Since some of the spots are now outside the “art board”, they will be missed when drawing the plot. In this example, we lose 46 spots!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only x, y coordinates</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>xy_coords <span class="ot">&lt;-</span> xy <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(pxl_col_in_fullres, pxl_row_in_fullres)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply transformations</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>transf.res <span class="ot">&lt;-</span> <span class="fu">CoordAndImageTransform</span>(im, xy_coords, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">xy_offset =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot results</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> transf.res<span class="sc">$</span>im_transf <span class="sc">|&gt;</span> </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rasterGrob</span>(<span class="at">width =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"npc"</span>), <span class="at">height =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"npc"</span>), <span class="at">interpolate =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add selected to transf.res$xy_transf</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>transf.res<span class="sc">$</span>xy_transf<span class="sc">$</span>selected <span class="ot">&lt;-</span> xy<span class="sc">$</span>selected</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(transf.res<span class="sc">$</span>xy_transf, <span class="fu">aes</span>(tr_x, <span class="fu">image_info</span>(im)<span class="sc">$</span>height <span class="sc">-</span> tr_y, </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="fu">factor</span>(selected))) <span class="sc">+</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(g, <span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span>) <span class="sc">+</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">image_info</span>(im)<span class="sc">$</span>width), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">image_info</span>(im)<span class="sc">$</span>height), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 46 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="images_and_coordinates_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="864"></p>
</div>
</div>
</section>
<section id="rotation-translation" class="level3">
<h3 class="anchored" data-anchor-id="rotation-translation">Rotation + translation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only x, y coordinates</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>xy_coords <span class="ot">&lt;-</span> xy <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(pxl_col_in_fullres, pxl_row_in_fullres)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply transformations</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>transf.res <span class="ot">&lt;-</span> <span class="fu">CoordAndImageTransform</span>(im, xy_coords, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">xy_offset =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">100</span>))</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot results</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> transf.res<span class="sc">$</span>im_transf <span class="sc">|&gt;</span> </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rasterGrob</span>(<span class="at">width =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"npc"</span>), <span class="at">height =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"npc"</span>), <span class="at">interpolate =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add selected to transf.res$xy_transf</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>transf.res<span class="sc">$</span>xy_transf<span class="sc">$</span>selected <span class="ot">&lt;-</span> xy<span class="sc">$</span>selected</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(transf.res<span class="sc">$</span>xy_transf, <span class="fu">aes</span>(tr_x, <span class="fu">image_info</span>(im)<span class="sc">$</span>height <span class="sc">-</span> tr_y, </span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="fu">factor</span>(selected))) <span class="sc">+</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(g, <span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span>) <span class="sc">+</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">image_info</span>(im)<span class="sc">$</span>width), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">image_info</span>(im)<span class="sc">$</span>height), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 672 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="images_and_coordinates_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="864"></p>
</div>
</div>
</section>
</section>
<section id="date" class="level2">
<h2 class="anchored" data-anchor-id="date">Date</h2>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">date</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Fri Sep 23 15:51:36 2022"</code></pre>
</div>
</div>
</section>
<section id="session" class="level2">
<h2 class="anchored" data-anchor-id="session">Session</h2>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">session_info</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.2.1 (2022-06-23)
 os       macOS Big Sur ... 10.16
 system   x86_64, darwin13.4.0
 ui       unknown
 language (EN)
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       Europe/Stockholm
 date     2022-09-23
 pandoc   2.18 @ /Applications/RStudio.app/Contents/MacOS/quarto/bin/tools/ (via rmarkdown)

─ Packages ───────────────────────────────────────────────────────────────────
 package         * version  date (UTC) lib source
 abind             1.4-5    2016-07-21 [1] CRAN (R 4.2.1)
 assertthat        0.2.1    2019-03-21 [1] CRAN (R 4.2.1)
 cachem            1.0.6    2021-08-19 [1] CRAN (R 4.2.1)
 callr             3.7.2    2022-08-22 [1] CRAN (R 4.2.1)
 cli               3.3.0    2022-04-25 [1] CRAN (R 4.2.1)
 cluster           2.1.4    2022-08-22 [1] CRAN (R 4.2.1)
 codetools         0.2-18   2020-11-04 [1] CRAN (R 4.2.1)
 colorspace        2.0-3    2022-02-21 [1] CRAN (R 4.2.1)
 cowplot           1.1.1    2020-12-30 [1] CRAN (R 4.2.1)
 crayon            1.5.1    2022-03-26 [1] CRAN (R 4.2.1)
 data.table        1.14.2   2021-09-27 [1] CRAN (R 4.2.1)
 DBI               1.1.3    2022-06-18 [1] CRAN (R 4.2.1)
 deldir            1.0-6    2021-10-23 [1] CRAN (R 4.2.1)
 devtools          2.4.4    2022-07-20 [1] CRAN (R 4.2.1)
 digest            0.6.29   2021-12-01 [1] CRAN (R 4.2.1)
 dplyr           * 1.0.9    2022-04-28 [1] CRAN (R 4.2.1)
 ellipsis          0.3.2    2021-04-29 [1] CRAN (R 4.2.1)
 evaluate          0.16     2022-08-09 [1] CRAN (R 4.2.1)
 fansi             1.0.3    2022-03-24 [1] CRAN (R 4.2.1)
 farver            2.1.1    2022-07-06 [1] CRAN (R 4.2.1)
 fastmap           1.1.0    2021-01-25 [1] CRAN (R 4.2.1)
 fitdistrplus      1.1-8    2022-03-10 [1] CRAN (R 4.2.1)
 fs                1.5.2    2021-12-08 [1] CRAN (R 4.2.1)
 future            1.27.0   2022-07-22 [1] CRAN (R 4.2.1)
 future.apply      1.9.0    2022-04-25 [1] CRAN (R 4.2.1)
 generics          0.1.3    2022-07-05 [1] CRAN (R 4.2.1)
 ggplot2         * 3.3.6    2022-05-03 [1] CRAN (R 4.2.1)
 ggrepel           0.9.1    2021-01-15 [1] CRAN (R 4.2.1)
 ggridges          0.5.3    2021-01-08 [1] CRAN (R 4.2.1)
 globals           0.16.0   2022-08-05 [1] CRAN (R 4.2.1)
 glue              1.6.2    2022-02-24 [1] CRAN (R 4.2.1)
 goftest           1.2-3    2021-10-07 [1] CRAN (R 4.2.1)
 gridExtra         2.3      2017-09-09 [1] CRAN (R 4.2.1)
 gtable            0.3.0    2019-03-25 [1] CRAN (R 4.2.1)
 htmltools         0.5.3    2022-07-18 [1] CRAN (R 4.2.1)
 htmlwidgets       1.5.4    2021-09-08 [1] CRAN (R 4.2.1)
 httpuv            1.6.5    2022-01-05 [1] CRAN (R 4.2.1)
 httr              1.4.4    2022-08-17 [1] CRAN (R 4.2.1)
 ica               1.0-3    2022-07-08 [1] CRAN (R 4.2.1)
 igraph            1.3.4    2022-07-19 [1] CRAN (R 4.2.1)
 irlba             2.3.5    2021-12-06 [1] CRAN (R 4.2.1)
 jsonlite        * 1.8.0    2022-02-22 [1] CRAN (R 4.2.1)
 KernSmooth        2.23-20  2021-05-03 [1] CRAN (R 4.2.1)
 knitr             1.39     2022-04-26 [1] CRAN (R 4.2.1)
 labeling          0.4.2    2020-10-20 [1] CRAN (R 4.2.1)
 later             1.3.0    2021-08-18 [1] CRAN (R 4.2.1)
 lattice           0.20-45  2021-09-22 [1] CRAN (R 4.2.1)
 lazyeval          0.2.2    2019-03-15 [1] CRAN (R 4.2.1)
 leiden            0.4.2    2022-05-09 [1] CRAN (R 4.2.1)
 lifecycle         1.0.1    2021-09-24 [1] CRAN (R 4.2.1)
 listenv           0.8.0    2019-12-05 [1] CRAN (R 4.2.1)
 lmtest            0.9-40   2022-03-21 [1] CRAN (R 4.2.1)
 magick          * 2.7.3    2021-08-18 [1] CRAN (R 4.2.1)
 magrittr          2.0.3    2022-03-30 [1] CRAN (R 4.2.1)
 MASS              7.3-58.1 2022-08-03 [1] CRAN (R 4.2.1)
 Matrix            1.4-1    2022-03-23 [1] CRAN (R 4.2.1)
 matrixStats       0.62.0   2022-04-19 [1] CRAN (R 4.2.1)
 memoise           2.0.1    2021-11-26 [1] CRAN (R 4.2.1)
 mgcv              1.8-40   2022-03-29 [1] CRAN (R 4.2.1)
 mime              0.12     2021-09-28 [1] CRAN (R 4.2.1)
 miniUI            0.1.1.1  2018-05-18 [1] CRAN (R 4.2.1)
 munsell           0.5.0    2018-06-12 [1] CRAN (R 4.2.1)
 nlme              3.1-159  2022-08-09 [1] CRAN (R 4.2.1)
 parallelly        1.32.1   2022-07-21 [1] CRAN (R 4.2.1)
 patchwork         1.1.2    2022-08-19 [1] CRAN (R 4.2.1)
 pbapply           1.5-0    2021-09-16 [1] CRAN (R 4.2.1)
 pillar            1.8.1    2022-08-19 [1] CRAN (R 4.2.1)
 pkgbuild          1.3.1    2021-12-20 [1] CRAN (R 4.2.1)
 pkgconfig         2.0.3    2019-09-22 [1] CRAN (R 4.2.1)
 pkgload           1.3.0    2022-06-27 [1] CRAN (R 4.2.1)
 plotly            4.10.0   2021-10-09 [1] CRAN (R 4.2.1)
 plyr              1.8.7    2022-03-24 [1] CRAN (R 4.2.1)
 png               0.1-7    2013-12-03 [1] CRAN (R 4.2.1)
 polyclip          1.10-0   2019-03-14 [1] CRAN (R 4.2.1)
 prettyunits       1.1.1    2020-01-24 [1] CRAN (R 4.2.1)
 processx          3.7.0    2022-07-07 [1] CRAN (R 4.2.1)
 profvis           0.3.7    2020-11-02 [1] CRAN (R 4.2.1)
 progressr         0.10.1   2022-06-03 [1] CRAN (R 4.2.1)
 promises          1.2.0.1  2021-02-11 [1] CRAN (R 4.2.1)
 ps                1.7.1    2022-06-18 [1] CRAN (R 4.2.1)
 purrr             0.3.4    2020-04-17 [1] CRAN (R 4.2.1)
 R6                2.5.1    2021-08-19 [1] CRAN (R 4.2.1)
 RANN              2.6.1    2019-01-08 [1] CRAN (R 4.2.1)
 RColorBrewer      1.1-3    2022-04-03 [1] CRAN (R 4.2.1)
 Rcpp              1.0.9    2022-07-08 [1] CRAN (R 4.2.1)
 RcppAnnoy         0.0.19   2021-07-30 [1] CRAN (R 4.2.1)
 remotes           2.4.2    2021-11-30 [1] CRAN (R 4.2.1)
 reshape2          1.4.4    2020-04-09 [1] CRAN (R 4.2.1)
 reticulate        1.25     2022-05-11 [1] CRAN (R 4.2.1)
 rgeos             0.5-9    2021-12-15 [1] CRAN (R 4.2.1)
 rlang           * 1.0.4    2022-07-12 [1] CRAN (R 4.2.1)
 rmarkdown         2.15     2022-08-16 [1] CRAN (R 4.2.1)
 ROCR              1.0-11   2020-05-02 [1] CRAN (R 4.2.1)
 rpart             4.1.16   2022-01-24 [1] CRAN (R 4.2.1)
 rstudioapi        0.14     2022-08-22 [1] CRAN (R 4.2.1)
 Rtsne             0.16     2022-04-17 [1] CRAN (R 4.2.1)
 scales            1.2.1    2022-08-20 [1] CRAN (R 4.2.1)
 scattermore       0.8      2022-02-14 [1] CRAN (R 4.2.1)
 sctransform       0.3.4    2022-08-20 [1] CRAN (R 4.2.1)
 sessioninfo       1.2.2    2021-12-06 [1] CRAN (R 4.2.1)
 Seurat          * 4.1.1    2022-05-02 [1] CRAN (R 4.2.1)
 SeuratObject    * 4.1.0    2022-05-01 [1] CRAN (R 4.2.1)
 shiny             1.7.2    2022-07-19 [1] CRAN (R 4.2.1)
 sp              * 1.5-0    2022-06-05 [1] CRAN (R 4.2.1)
 spatstat.core     2.4-4    2022-05-18 [1] CRAN (R 4.2.1)
 spatstat.data     2.2-0    2022-04-18 [1] CRAN (R 4.2.1)
 spatstat.geom     2.4-0    2022-03-29 [1] CRAN (R 4.2.1)
 spatstat.random   2.2-0    2022-03-30 [1] CRAN (R 4.2.1)
 spatstat.sparse   2.1-1    2022-04-18 [1] CRAN (R 4.2.1)
 spatstat.utils    2.3-1    2022-05-06 [1] CRAN (R 4.2.1)
 stringi           1.7.8    2022-07-11 [1] CRAN (R 4.2.1)
 stringr           1.4.1    2022-08-20 [1] CRAN (R 4.2.1)
 STUtility2      * 0.1.0    2022-09-23 [1] local
 survival          3.4-0    2022-08-09 [1] CRAN (R 4.2.1)
 tensor            1.5      2012-05-05 [1] CRAN (R 4.2.1)
 tibble            3.1.8    2022-07-22 [1] CRAN (R 4.2.1)
 tidyr             1.2.0    2022-02-01 [1] CRAN (R 4.2.1)
 tidyselect        1.1.2    2022-02-21 [1] CRAN (R 4.2.1)
 urlchecker        1.0.1    2021-11-30 [1] CRAN (R 4.2.1)
 usethis           2.1.6    2022-05-25 [1] CRAN (R 4.2.1)
 utf8              1.2.2    2021-07-24 [1] CRAN (R 4.2.1)
 uwot              0.1.14   2022-08-22 [1] CRAN (R 4.2.1)
 vctrs             0.4.1    2022-04-13 [1] CRAN (R 4.2.1)
 viridisLite       0.4.1    2022-08-22 [1] CRAN (R 4.2.1)
 withr             2.5.0    2022-03-03 [1] CRAN (R 4.2.1)
 xfun              0.32     2022-08-10 [1] CRAN (R 4.2.1)
 xtable            1.8-4    2019-04-21 [1] CRAN (R 4.2.1)
 yaml              2.3.5    2022-02-21 [1] CRAN (R 4.2.1)
 zoo               1.8-10   2022-04-15 [1] CRAN (R 4.2.1)

 [1] /Users/ludviglarsson/miniconda3/envs/R4.2/lib/R/library

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>